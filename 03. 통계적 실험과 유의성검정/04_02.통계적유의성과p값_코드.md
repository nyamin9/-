# ğŸ° 04_02. í†µê³„ì ìœ ì˜ì„±ê³¼ p-value  

## ğŸ° 07.01. R ì½”ë“œ  

ğŸ² ì‚¬ìš© ë°ì´í„°  

<br>  


| ê²°ê³¼ | ê°€ê²©A | ê°€ê²©B |   
| -- | -- | -- |  
|êµ¬ë§¤|200|182|  
|êµ¬ë§¤í•˜ì§€ ì•ŠìŒ|23,539|22,406|  

<br>  


ğŸ² ìˆœì—´ê²€ì •  


```r  

# ìˆœì—´ê²€ì •

## ìˆœì—´ê²€ì • ì ìš©ì„ ìœ„í•œ ê° ê·¸ë£¹(ê°€ê²©A/ê°€ê²©B)ì— êµ¬ë§¤ì—¬ë¶€ë¥¼ ëœë¤í•˜ê²Œ í• ë‹¹
## ë¹„ë³µì›ì¶”ì¶œë¡œ nBê°œì˜ í‘œë³¸ì„ ì¶”ì¶œí•´ ê·¸ë£¹ Bì— í• ë‹¹
## ë‚˜ë¨¸ì§€ nAê°œëŠ” ê·¸ë£¹ Aì— í• ë‹¹
## ì´ë•Œ ë‘ ê·¸ë£¹ì˜ í‰ê· ì˜ ì°¨ì´ë¥¼ ê²°ê³¼ë¡œ ë°˜í™˜

perm_fun <- function(x, nA, nB)
{
  n <- nA + nB
  idx_b <- sample(1:n, nB)
  idx_a <- setdiff(1:n, idx_b)
  mean_diff <- mean(x[idx_b]) - mean(x[idx_a])
  return(mean_diff)
}


## ê´€ì°°ëœ ê²€ì •í†µê³„ëŸ‰ ê³„ì‚°
## ê°€ê²© Aì™€ ê°€ê²© Bì˜ êµ¬ë§¤ìœ¨ ì°¨ì´
obs_pct_diff <- 100 * (200/23739 - 182/22588)


## ë°ì´í„° ìƒì„±
## 45945ê°œì˜ 0 (ë¹„êµ¬ë§¤) / 382ê°œì˜ 1 (êµ¬ë§¤)
buy <- c(rep(0, 45945), rep(1, 382))


## 1000íšŒì˜ ìˆœì—´ê²€ì • ê²°ê³¼ë¥¼ ì €ì •í•  ë°ì´í„° ìƒì„±
perm_diffs <- rep(0, 1000)


## ìˆœì—´ê²€ì • ì‹œí–‰
for (i in 1:1000) {
  perm_diffs[i] = 100 * perm_fun(buy, 23739, 22588)
}


## ê²°ê³¼ ì‹œê°í™”
hist(perm_diffs, xlab = 'Buying rate (percent)', main = '')
abline(v = obs_pct_diff)
```  

![image](https://user-images.githubusercontent.com/65170165/215303179-5f508274-2068-4e66-885a-7ae2ce06bf33.png)  

<br>  


ğŸ² p-value : `ìˆœì—´ê²€ì •ìœ¼ë¡œ ì–»ì€ ê²°ê³¼ ì¤‘ì—ì„œ ìš°ì—°íˆ ê´€ì°°ëœ ê²€ì •í†µê³„ëŸ‰ê³¼ ê°™ê±°ë‚˜ ê·¸ë³´ë‹¤ í° ì°¨ì´ë¥¼ ë³´ì´ëŠ” ê²½ìš°ì˜ ë¹„ìœ¨`  


```r
# p-value

## ìˆœì—´ê²€ì •ìœ¼ë¡œ ì–»ì€ ê²°ê³¼ ì¤‘ì—ì„œ ìš°ì—°íˆ ê´€ì°°ëœ ê²€ì •í†µê³„ëŸ‰ê³¼ ê°™ê±°ë‚˜ ê·¸ë³´ë‹¤ í° ì°¨ì´ë¥¼ ë³´ì´ëŠ” ê²½ìš°ì˜ ë¹„ìœ¨
## p-valueë¥¼ êµ¬í•˜ëŠ” ê²½ìš°

mean(perm_diffs > obs_pct_diff)
```  
```
>> [1] 0.327
```  

<br>  

ğŸ² p-valueì˜ ê·¼ì‚¬ : `prop.test(x = c( êµ¬ë§¤&ê°€ê²©A, êµ¬ë§¤&ê°€ê²©B ), n = c( ë¹„êµ¬ë§¤&ê°€ê²©A, ë¹„êµ¬ë§¤&ê°€ê²©B ), alternative = 'greater')`  

```r
# p-value

## ë°ì´í„°ì˜ ì–‘ì´ ì¶©ë¶„í•˜ê³ , ê°€ì„¤ì´ ì´í•­ë¶„í¬ë¥¼ ë”°ë¥´ë©´ ìˆœì—´ê²€ì • ëŒ€ì‹  p-valueë¥¼ ê·¼ì‚¬í•  ìˆ˜ ìˆìŒ
prop.test(x = c(200, 182), n = c(23739, 22588), alternative = 'greater') 

```  
```  
>>

  2-sample test for equality of proportions with continuity correction

  data:  c(200, 182) out of c(23739, 22588)
  X-squared = 0.14893, df = 1, p-value = 0.3498
  alternative hypothesis: greater
  95 percent confidence interval:
  -0.001057439  1.000000000
  sample estimates:
      prop 1      prop 2 
  0.008424955     0.008057376 
```  


<br>  

***  

## ğŸ° 04.02. python ì½”ë“œ  

ğŸ² ì‚¬ìš© ë°ì´í„°  

<br>  


| ê²°ê³¼ | ê°€ê²©A | ê°€ê²©B |   
| -- | -- | -- |  
|êµ¬ë§¤|200|182|  
|êµ¬ë§¤í•˜ì§€ ì•ŠìŒ|23,539|22,406|  

<br>  


ğŸ² ìˆœì—´ê²€ì •  


```py

## ê´€ì°°ëœ ê²€ì •í†µê³„ëŸ‰ ê³„ì‚°
## ê°€ê²© Aì™€ ê°€ê²© Bì˜ êµ¬ë§¤ìœ¨ ì°¨ì´
obs_pct_diff = 100 * (200 / 23739 - 182 / 22588)
print(f'Observed difference: {obs_pct_diff:.4f}%')

```  
```
>> Observed difference: 0.0368%
```  

<br>  


```py 

## ë°ì´í„° ìƒì„±
## 45945ê°œì˜ 0 (ë¹„êµ¬ë§¤) / 382ê°œì˜ 1 (êµ¬ë§¤)
buy = [0] * 45945
buy.extend([1] * 382)
buy = pd.Series(buy)

```  

```py

## ìˆœì—´ê²€ì • ì ìš©ì„ ìœ„í•œ ê° ê·¸ë£¹(ê°€ê²©A/ê°€ê²©B)ì— êµ¬ë§¤ì—¬ë¶€ë¥¼ ëœë¤í•˜ê²Œ í• ë‹¹
## ë¹„ë³µì›ì¶”ì¶œë¡œ nBê°œì˜ í‘œë³¸ì„ ì¶”ì¶œí•´ ê·¸ë£¹ Bì— í• ë‹¹
## ë‚˜ë¨¸ì§€ nAê°œëŠ” ê·¸ë£¹ Aì— í• ë‹¹
## ì´ë•Œ ë‘ ê·¸ë£¹ì˜ í‰ê· ì˜ ì°¨ì´ë¥¼ ê²°ê³¼ë¡œ ë°˜í™˜
def perm_fun(x, nA, nB):
    n = nA + nB
    idx_B = set(random.sample(range(n), nB))
    idx_A = set(range(n)) - idx_B
    return x.loc[idx_B].mean() - x.loc[idx_A].mean()
    
    
## ìˆœì—´ê²€ì • 1000íšŒ ì‹œí–‰    
perm_diffs = [100 * perm_fun(buy, 23739, 22588) for _ in range(1000)] 


## ê²°ê³¼ ì‹œê°í™”
fig, ax = plt.subplots(figsize = (6,6))
ax.hist(perm_diffs, bins = 11, rwidth = 0.9)
ax.axvline(x = obs_pct_diff, color = 'black', lw = 2)
ax.text(0.06, 200, 'Observed\ndifference', bbox = {'facecolor' : 'white'})  

```  

![image](https://user-images.githubusercontent.com/65170165/215303796-7f15e0a0-50dd-418a-a380-45be97725120.png)  

<br>  

ğŸ² p-value : `ìˆœì—´ê²€ì •ìœ¼ë¡œ ì–»ì€ ê²°ê³¼ ì¤‘ì—ì„œ ìš°ì—°íˆ ê´€ì°°ëœ ê²€ì •í†µê³„ëŸ‰ê³¼ ê°™ê±°ë‚˜ ê·¸ë³´ë‹¤ í° ì°¨ì´ë¥¼ ë³´ì´ëŠ” ê²½ìš°ì˜ ë¹„ìœ¨`

```py
np.mean([diff > obs_pct_diff for diff in perm_diffs])
```  
```
>> 0.333
```  

<br>  

ğŸ² p-valueì˜ ê·¼ì‚¬ : `chi2, p_value, df, _ = st.chi2_contingency(data)`  


```py  
import scipy.stats as st

survivors = np.array([[200, 23739 - 200], [182, 22588 - 182]])
chi2, p_value, df, _ = st.chi2_contingency(survivors)

print(f'p-value for single sided test : {p_value / 2:.4f}')
```  
```  
>> p-value for single sided test : 0.3498
```  

<br>  

***  

ğŸ² ê²°ë¡ ì ìœ¼ë¡œ ê°€ê²© Aì™€ ê°€ê²© Bì— ëŒ€í•œ êµ¬ë§¤ì—¬ë¶€ ë°ì´í„°ë¥¼ í†µí•´ ìš°ë¦¬ëŠ” ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.  

- ìˆœì—´ê²€ì •ì„ í†µí•´ ëœë¤í•œ ë³€ì´ë¥¼ ëª¨ë¸ë§í•  ìˆ˜ ìˆìœ¼ë©°, ìš°ë¦¬ê°€ ê´€ì°°í•œ ê²€ì •í†µê³„ëŸ‰ 0.0368% ëŠ” ìš°ì—°ì—ì„œ ë‚˜ì˜¤ëŠ” ê²°ê³¼ì„ì„ íŒŒì•…í–ˆë‹¤.  
   
- ë˜í•œ p-valueë¥¼ êµ¬í•´ ìœ„ ë°ì´í„°ì˜ ê²½ìš°ì— í•´ë‹¹í•˜ëŠ” ì‚¬ê±´ì´ ìš°ì—°íˆ ë‚˜ì˜¤ì§€ ì•Šì„ í™•ë¥  ë˜í•œ ì•Œì•„ë³´ì•˜ëŠ”ë°, ì´ëŠ” ëŒ€ëµ 0.3 ì •ë„ì˜ ê°’ì´ ë‚˜ì™”ë‹¤.  
 

***  

