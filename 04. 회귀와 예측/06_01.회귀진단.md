# 🎰 06_01. 회귀진단  

🎲 설명을 위한 모델링에서는 여러 측정 지표들을 고려하며, 매 단계마다 모델이 데이터에 얼마나 적합한지 평가함.  

🎲 대부분은 잔차 분석을 기본으로 함  

🎲 직접적으로 예측 정확도를 다루는 것은 아니지만 설정을 위한 중요한 통찰을 줄 수 있음  

<br>  


🎲 용어 정리  

- 표준화잔차 (standardized residual) : 잔차를 표준오차로 나눈 값  
   
- 특잇값 (outlier) : 나머지 데이터와 멀리 떨어진 레코드  
   
- 영향값 (influential value) : 유무에 따라 회귀방정식이 큰 차이를 보이는 레코드  
   
- 레버리지 (leverage) : 회귀식에 하나의 레코드가 미치는 영향력의 정도 (≒ 햇 값 hat-value)  
   
- 비정규 잔차 (non-normal residual) : 정규분포를 따르지 않는 잔차는 회귀분석의 요건을 무효로 만들 수 있음  
   
- 이분산성 (heteroskedasticity) : 어떤 범위 내 출력값의 잔차의 분산이 일정하지 않음 (어떤 예측변수를 회귀식이 놓치고 있다는 것을 의미)  
   
- 편잔차그림 (partial residual plot) : 결과변수와 특정 예측변수 사이의 관계를 진단하는 그림  
   
<br>  

## 🎰 01. 특잇값  

🎲 특잇값은 대부분의 측정치에서 멀리 벗어난 값을 의미함  

🎲 회귀에서 특잇값은 실제 y 값이 예측된 값에서 멀리 떨어져 있는 경우를 말함   

<br>  

🎲 잔차를 표준오차로 나눈 값인 표준화잔차를 조사해 특잇값을 발견함  

🎲 특잇값을 정상값들과 구분하는 것에 관한 통계 이론은 없으나, 관측값이 다수 데이터로부터 얼마나 떨어졌느냐에 대한 임의의 경험칙이 존재  

🎲 예를 들어 상자그림에서 상자 경계선 바깥에 위치한 점들을 특잇값이라 봄  

🎲 이와 비슷하게 회귀에서는 표준화잔차가 특잇값을 검출하는 데 주로 사용됨  

🎲 표준화잔차는 회귀선으로부터 떨어진 정도를 표준오차의 개수로 표현한 값으로 해석함  

<br>  

🎲 비정상적인 데이터는 회귀에 포함되어서는 안됨  

🎲 특잇값은 데이터 입력 또는 단위 실수 (일 달러 단위를 천 달러 단위로 기재하는 경우) 등의 문제들 때문에 발생할 수 있음  

<br>  


🎲 빅데이터의 경우 새로운 데이터를 예측을 위한 회귀분석에서 특잇값이 그렇게 문제가 되지는 않음.  

🎲그러나 특잇값을 찾는 것이 목적인 특잇값 검출의 경우 이 값들이 매우 중요해짐.  

<br>  

***  


## 🎰 02. 영향값  

🎲 회귀모형에서 제외됐을 때 모델에 중요한 변화를 가져오는 값을 주영향관측값 (influential observation) 이라고 함  

🎲 회귀분석에서, 잔차가 크다고 해서 모두 이런 값이 되는 것은 아님  

🎲 큰 회귀선 변화를 유발하는 데이터 값이 원래 회귀에서 특잇값으로 나타나지 않는 경우 해당 데이터는 회귀에 대해 높은 레버리지(영향력)를 가짐.  

<br>  


📌 레버리지 측정 척도 1 : 햇 값 (hat-value)  ->  $2(P+1)/n$ 이상의 값들은 레버리지가 높은 데이터 값을 나타냄  

📌 레버리지 측정 척도 2 : 쿡의 거리 (Cook’s distance)  ->  레버리지와 잔차의 크기를 합쳐서 영향력을 판단.  

- 쿡의 거리가 $4 / (n-P-1)$ 보다 크면 영향력이 높다고 봄  

<br>  

🎲 전체 데이터를 모두 사용한 회귀 결과와 영향력인 큰 데이터들을 제외하고 얻은 회귀 결과를 비교하면 변화량이 큰 회귀계수를 발견할 수 있음  

<br>  

🎲 회귀모형의 목적이 새로운 값에 대한 예측값을 얻기 위한 경우, 작은 크기의 데이터에서만 영향력이 큰 데이터를 확인하는 작업이 유용함  

🎲 또한 이상치 검출에 있어서도 영향력이 높은 값들을 찾는 것이 도움이 됨  

<br>  

***  

## 🎰 03. 이분산성, 비정규성, 오차 간 자기상관  

🎲 보통최소제곱추정(RMSE)은 다양한 분포 가정하에서 편향성이 없고 경우에 따라 최적이라고 할 수 있는 추정을 제공함  

🎲 잔차의 분포는 가설검정 및 p-value의 유효성과 관련이 있기에 예측에 있어서는 너무 많은 신경을 쓸 필요는 없음  

<br>  

🎲 반면 오차가 정규분포를 따르지 않는다면 모델에서 뭔가가 누락되었을 수 있음을 의미함  

🎲 하지만 예측값에 따라 달라지는 오차를 판별하기는 어렵기에, 잔차를 바탕으로 모델의 몇 가지 가정을 검토함  

1. 잔차는 동일한 분산을 가짐  
2. 잔차는 정규분포를 따름  
3. 잔차는 서로 독립  
 
🎲 이를 바탕으로, 잔차에 대한 가정을 기반으로 예상치에 대한 신뢰구간을 계산함  

🎲 특히 회귀모형을 일반적인 추론 (가설검정, p-value)을 위해 사용할 경우 잔차 분포에 대한 특정 가정을 확인해야 함  


<br>  

📌 이분산성  

- 다양한 범위의 예측값에 따라 잔차의 분산이 일정하지 않은 것을 의미함  
   
- 즉, 어떤 일부분에서의 오차가 다른 데보다 훨씬 크게 나타나는 것을 의미함  
   
<br>  

📌 비정규성  

- 잔차에 대한 히스토그램을 그려 그 분포를 파악함  
   
- 만들어진 분포를 정규분포와 비교하여 정규성을 확인  
   
<br>  

📌 자기상관  

- 시간과 공간에 따라 데이터를 수집하는 경우 오차가 독립적이라는 가정을 점검하는 경우가 많음  
   
- 특히 시계열 데이터를 다루는 회귀분석에서 오차 간 유의미한 자기상관 (autocorrelation)이 있는지를 탐지함  
  - 더빈 - 왓슨 통계량 (Durbin-Watson statistic) 을 사용  
     
- 만약 회귀모형 오차들 간에 상관관계가 있는 경우, 이는 단기 예측에 유용할 수 있으며 모델을 만들 때 고려해야 함  
   
- 특히 장기적인 예측이나 설명 모델이 필요한 경우 과도한 자기상관 데이터는 방해가 될 수 있음  
   
  - 이 경우에는 우선 데이터를 평활화하거나 또는 데이터 수집의 구간을 넓히는 것이 필요함  
     
<br>  

***  

## 🎰 04. 편잔차그림과 비선형성  

🎲 편잔차그림 : 예측 모델이 예측변수와 결과변수 간의 관계를 얼마나 잘 설명하는지 시각화하는 방법  

🎲 편잔차 : 단일 독립변수를 기반으로 한 예측값과 전체를 고려한 회귀식의 실제 잔차를 결합하여 만든 결과  

🎲 예측변수 $X_i$의 편잔차는 일반 잔차에 $X_i$와 연관된 회귀 항을 더한 값 -> 각 회귀 항의 적합성을 정량적으로 평가

- 편잔차 = 잔차 + $\hat{b_i}X_i$  
   
<br>  

🎲 편잔차그림 결과  

![image](https://user-images.githubusercontent.com/65170165/217290750-3a60250d-33b8-4ec4-a5be-c2e1937fa9d2.png)  

- 위 그림에서는 실선이 회귀선을, 점선이 평활곡선 (실제 변수 간 관계) 을 의미함  
  
- 대체 모델에 대한 아이디어를 얻을 수 있음 -> 선형 / 비선형 
 
<br>  

***  
